version: '3'

services:
  pihole:
    container_name: pihole
    image: pihole/pihole:2023.03.1
    restart: 'no'
    environment:
      TZ: Europe/Paris
      WEBPASSWORD: $PIHOLE_PASSWORD
      DNSMASQ_USER: root
    volumes:
      - data:/etc/pihole
      - dnsmasq:/etc/dnsmasq.d
      - var:/var
    labels:
      traefik.enable: true
      traefik.http.routers.pihole.tls: true
      traefik.http.routers.pihole.entrypoints: websecure
      traefik.http.routers.pihole.rule: Host(`pihole.$PERSONAL_DOMAINE_NAME`)
      traefik.http.services.pihole.loadbalancer.server.port: 80
    ports:
      - 53:53/tcp
      - 53:53/udp
      - $PERSONAL_PORT_PIHOLE:80
    networks:
      - web

volumes:
  var:
  data:
  dnsmasq:

networks:
  web:
    external: true