version: '3'

services:
  pihole:
    container_name: pihole
    image: pihole/pihole:2023.03.1
    restart: 'no'
    environment:
      TZ: Europe/Paris
      WEBPASSWORD: $PIHOLE_PASSWORD
      DNSMASQ_USER: pihole
      user: "${PERSONAL_UID_PIHOLE}:${PERSONAL_GID_PIHOLE}"
      FTLCONF_LOCAL_IPV4: 192.168.1.1
    volumes:
      - data:/etc/pihole
      - dnsmasq:/etc/dnsmasq.d
      # - file:/var
    labels:
      traefik.enable: true
      traefik.http.routers.pihole.tls: true
      traefik.http.routers.pihole.entrypoints: websecure
      traefik.http.routers.pihole.rule: Host(`pihole.$PERSONAL_DOMAINE_NAME`)
      traefik.http.services.pihole.loadbalancer.server.port: 80
    ports:
      - 53:53/tcp
      - 53:53/udp
      - $PERSONAL_PORT_PIHOLE:80
    networks:
      - web
    command: sh -c "chown -R 777 /var"

  #   depends_on:
  #     - file-helper


  # file-helper:
  #   container_name: file-helper-pihole
  #   restart: 'no'
  #   image: alpine:latest
  #   environment:
  #     - TZ=Europe/Paris
  #   command: 
  #       - sh
  #       - -c
  #       - >
  #         ls /file;
  #         chown -R 777 /file;

  #   volumes:
  #     - file:/file
  #   networks:
  #     - web

volumes:
  data:
  dnsmasq:
  # file:

networks:
  web:
    external: true