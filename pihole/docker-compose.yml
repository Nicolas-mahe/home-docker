version: '3'

services:
  pihole:
    container_name: pihole
    image: pihole/pihole
    restart: 'no'
    environment:
      TZ: Europe/Paris
      WEBPASSWORD: $PIHOLE_PASSWORD
      UID: $PERSONAL_UID_PIHOLE
      GID: $PERSONAL_GID_PIHOLE
    volumes:
      - data:/etc/pihole
      - dnsmasq:/etc/dnsmasq.d
    labels:
      traefik.enable: true
      traefik.http.routers.pihole.tls: true
      traefik.http.routers.pihole.entrypoints: websecure
      traefik.http.routers.pihole.rule: Host(`pihole.$PERSONAL_DOMAINE_NAME`)
      traefik.http.services.pihole.loadbalancer.server.port: 80
    ports:
      - 53:53/tcp
      - 53:53/udp
      - $PERSONAL_PORT_PIHOLE:80
    networks:
      - web
    # command: 
    #     - bash
    #     - -c
    #     - >
    #       cd /var/log;
    #       sudo chown -R www-data:www-data lighttpd/;
          
volumes:
  data:
  dnsmasq:

networks:
  web:
    external: true